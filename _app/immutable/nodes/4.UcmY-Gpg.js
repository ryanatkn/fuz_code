import{f as A,a as $,d as Y,t as De}from"../chunks/DlUSUuuE.js";import{h as me,b as je,d as ze,aQ as Be,e as He,g as qe,i as Q,j as Ve,k as We,U as Ge,l as Qe,x as Xe,E as Ze,aR as Je,aS as Ke,m as Ye,u as Te,aT as et,a9 as Ne,a3 as tt,q as nt,F as J,aU as rt,aq as Se,n as ot,aV as at,p as ee,J as h,ah as k,c as b,r as g,a as te,W as C,f as W,s as S,t as V,I as q,K as he,aW as st,V as it}from"../chunks/Brg_2F-A.js";import{b as lt,s as L,d as ct}from"../chunks/p6G_AVMl.js";import{p as B,r as ut,i as U,s as _t}from"../chunks/Dx_bBUwt.js";import{b as dt,C as mt,e as K,a as ge,c as ft,r as re,d as vt,f as pt,s as ht}from"../chunks/Bd_5h5Vr.js";import{b as Ie}from"../chunks/DeLDTU9B.js";import{C as gt,s as yt}from"../chunks/Bk3o1Oju.js";import{s as wt}from"../chunks/7HYJ4EGG.js";import{a as bt}from"../chunks/P58BwoFi.js";import{c as Et}from"../chunks/CHFrDzX4.js";import{C as xt}from"../chunks/B5WxmWAY.js";function Mt(e,t,o){me&&je();var n=e,s=Ge,r,i,_=null,l=Be;function a(){r&&Qe(r),_!==null&&(_.lastChild.remove(),n.before(_),_=null),r=i}ze(()=>{if(l(s,s=t())){var c=n,v=Ve();v&&(_=document.createDocumentFragment(),_.append(c=He())),i=qe(()=>o(c)),v?Q.add_callback(a):a()}}),me&&(n=We)}const Tt=()=>performance.now(),z={tick:e=>requestAnimationFrame(e),now:()=>Tt(),tasks:new Set};function Re(){const e=z.now();z.tasks.forEach(t=>{t.c(e)||(z.tasks.delete(t),t.f())}),z.tasks.size!==0&&z.tick(Re)}function Nt(e){let t;return z.tasks.size===0&&z.tick(Re),{promise:new Promise(o=>{z.tasks.add(t={c:e,f:o})}),abort(){z.tasks.delete(t)}}}function ye(e,t){Ne(()=>{e.dispatchEvent(new CustomEvent(t))})}function St(e){if(e==="float")return"cssFloat";if(e==="offset")return"cssOffset";if(e.startsWith("--"))return e;const t=e.split("-");return t.length===1?t[0]:t[0]+t.slice(1).map(o=>o[0].toUpperCase()+o.slice(1)).join("")}function we(e){const t={},o=e.split(";");for(const n of o){const[s,r]=n.split(":");if(!s||r===void 0)break;const i=St(s.trim());t[i]=r.trim()}return t}const It=e=>e;function be(e,t,o,n){var s=(e&et)!==0,r="in",i,_=t.inert,l=t.style.overflow,a,c;function v(){return Ne(()=>i??(i=o()(t,(n==null?void 0:n())??{},{direction:r})))}var p={is_global:s,in(){t.inert=_,a==null||a.abort(),ye(t,"introstart"),a=Ce(t,v(),c,1,()=>{ye(t,"introend"),a==null||a.abort(),a=i=void 0,t.style.overflow=l})},out(x){{x==null||x(),i=void 0;return}},stop:()=>{a==null||a.abort()}},d=Xe;if((d.transitions??(d.transitions=[])).push(p),lt){var u=s;if(!u){for(var m=d.parent;m&&(m.f&Ze)!==0;)for(;(m=m.parent)&&(m.f&Je)===0;);u=!m||(m.f&Ke)!==0}u&&Ye(()=>{Te(()=>p.in())})}}function Ce(e,t,o,n,s){if(tt(t)){var r,i=!1;return nt(()=>{if(!i){var m=t({direction:"in"});r=Ce(e,m,o,n,s)}}),{abort:()=>{i=!0,r==null||r.abort()},deactivate:()=>r.deactivate(),reset:()=>r.reset(),t:()=>r.t()}}if(!(t!=null&&t.duration))return s(),{abort:J,deactivate:J,reset:J,t:()=>n};const{delay:_=0,css:l,tick:a,easing:c=It}=t;var v=[];if(a&&a(0,1),l){var p=we(l(0,1));v.push(p,p)}var d=()=>1-n,u=e.animate(v,{duration:_,fill:"forwards"});return u.onfinish=()=>{u.cancel();var m=1-n,x=n-m,f=t.duration*Math.abs(x),M=[];if(f>0){var T=!1;if(l)for(var E=Math.ceil(f/16.666666666666668),I=0;I<=E;I+=1){var y=m+x*c(I/E),N=we(l(y,1-y));M.push(N),T||(T=N.overflow==="hidden")}T&&(e.style.overflow="hidden"),d=()=>{var R=u.currentTime;return m+x*c(R/f)},a&&Nt(()=>{if(u.playState!=="running")return!1;var R=d();return a(R,1-R),!0})}u=e.animate(M,{duration:f,fill:"forwards"}),u.onfinish=()=>{d=()=>n,a==null||a(n,1-n),s()}},{abort:()=>{u&&(u.cancel(),u.effect=null,u.onfinish=J)},deactivate:()=>{s=J},reset:()=>{},t:()=>d()}}function oe(e,t,o=t){var n=new WeakSet;rt(e,"input",async s=>{var r=s?e.defaultValue:e.value;if(r=_e(e)?de(r):r,o(r),Q!==null&&n.add(Q),await Se(),r!==(r=t())){var i=e.selectionStart,_=e.selectionEnd;e.value=r??"",_!==null&&(e.selectionStart=i,e.selectionEnd=Math.min(_,e.value.length))}}),(me&&e.defaultValue!==e.value||Te(t)==null&&e.value)&&(o(_e(e)?de(e.value):e.value),Q!==null&&n.add(Q)),ot(()=>{var s=t();if(e===document.activeElement){var r=at??Q;if(n.has(r))return}_e(e)&&s===de(e.value)||e.type==="date"&&!s&&!e.value||s!==e.value&&(e.value=s??"")})}function _e(e){var t=e.type;return t==="number"||t==="range"}function de(e){return e===""?null:+e}function $e(e){const t=e-1;return t*t*t+1}function Rt(e,{delay:t=0,duration:o=400,easing:n=$e,axis:s="y"}={}){const r=getComputedStyle(e),i=+r.opacity,_=s==="y"?"height":"width",l=parseFloat(r[_]),a=s==="y"?["top","bottom"]:["left","right"],c=a.map(f=>`${f[0].toUpperCase()}${f.slice(1)}`),v=parseFloat(r[`padding${c[0]}`]),p=parseFloat(r[`padding${c[1]}`]),d=parseFloat(r[`margin${c[0]}`]),u=parseFloat(r[`margin${c[1]}`]),m=parseFloat(r[`border${c[0]}Width`]),x=parseFloat(r[`border${c[1]}Width`]);return{delay:t,duration:o,easing:n,css:f=>`overflow: hidden;opacity: ${Math.min(f*20,1)*i};${_}: ${f*l}px;padding-${a[0]}: ${f*v}px;padding-${a[1]}: ${f*p}px;margin-${a[0]}: ${f*d}px;margin-${a[1]}: ${f*u}px;border-${a[0]}-width: ${f*m}px;border-${a[1]}-width: ${f*x}px;min-${_}: 0`}}function Ct(e,{delay:t=0,duration:o=400,easing:n=$e,start:s=0,opacity:r=0}={}){const i=getComputedStyle(e),_=+i.opacity,l=i.transform==="none"?"":i.transform,a=1-s,c=_*(1-r);return{delay:t,duration:o,easing:n,css:(v,p)=>`
			transform: ${l} scale(${1-a*p});
			opacity: ${_-c*p}
		`}}var $t=A("<div>✓</div>"),Ot=A("<div>⧉</div>"),At=A("<button><!></button>");function Ft(e,t){ee(t,!0);const o=B(t,"copied_display_duration",3,1e3),n=B(t,"icon_button",3,!0),s=ut(t,["$$slots","$$events","$$legacy","text","copied_display_duration","allow_copying_empty_string","icon_button","oncopy","disabled","children","class"]);let r=k(!1),i=k(!1),_;const l=async d=>{var u;if(clearTimeout(_),t.text!==null){C(r,!1),C(i,!1);try{await navigator.clipboard.writeText(t.text),C(r,!0)}catch{C(i,!0);return}_=setTimeout(()=>{C(r,!1)},o()),(u=t.oncopy)==null||u.call(t,t.text,d)}};var a=At();dt(a,d=>({type:"button",title:"copy to clipboard",...s,class:`copy_to_clipboard ${t.class??""}`,onclick:l,disabled:t.disabled??(t.allow_copying_empty_string?t.text===null:!t.text),[mt]:d}),[()=>({icon_button:t.children?!1:n(),copied:h(r),failed:h(i),color_c:h(i)})]);var c=b(a);{var v=d=>{var u=Y(),m=W(u);wt(m,()=>t.children,()=>h(r),()=>h(i)),$(d,u)},p=d=>{var u=Y(),m=W(u);{var x=M=>{var T=$t();be(1,T,()=>Ct,()=>({duration:200})),$(M,T)},f=M=>{var T=Ot();be(1,T,()=>Rt),$(M,T)};U(m,M=>{h(r)?M(x):M(f,!1)},!0)}$(d,u)};U(c,d=>{t.children?d(v):d(p,!1)})}g(a),$(e,a),te()}const Lt=.25,Pt=.75,Ee=1.5,kt=3.5,Ut=5,xe=.6745,Dt=.3,jt=.4,zt=.8,Bt=.95,Ht=.99,qt=1.96,Vt=1e3,Wt=3,fe=e=>{const t=Math.floor(e.length/2);return e.length%2===0?(e[t-1]+e[t])/2:e[t]},Gt=e=>{if(e.length<Wt)return{cleaned_times:e,outliers:[]};const t=[...e].sort((l,a)=>l-a),o=fe(t),s=[...e.map(l=>Math.abs(l-o))].sort((l,a)=>l-a),r=fe(s);if(r===0){const l=t[Math.floor(t.length*Lt)],a=t[Math.floor(t.length*Pt)],c=a-l;if(c===0)return{cleaned_times:e,outliers:[]};const v=l-Ee*c,p=a+Ee*c,d=[],u=[];for(const m of e)m<v||m>p?u.push(m):d.push(m);return{cleaned_times:d,outliers:u}}const i=[],_=[];for(const l of e){const a=xe*(l-o)/r;Math.abs(a)>kt?_.push(l):i.push(l)}if(_.length>e.length*Dt){i.length=0,_.length=0;for(const l of e){const a=xe*(l-o)/r;Math.abs(a)>Ut?_.push(l):i.push(l)}if(_.length>e.length*jt){const l=e.map(c=>({time:c,distance:Math.abs(c-o)}));l.sort((c,v)=>c.distance-v.distance);const a=Math.floor(e.length*zt);i.length=0,_.length=0;for(let c=0;c<l.length;c++)c<a?i.push(l[c].time):_.push(l[c].time)}}return{cleaned_times:i,outliers:_}},Qt=e=>{const t=[];let o=0;for(const y of e.times)!isNaN(y)&&isFinite(y)&&y>0?t.push(y):o++;if(t.length===0)return{mean:NaN,median:NaN,std_dev:NaN,min:NaN,max:NaN,p95:NaN,p99:NaN,cv:NaN,confidence_interval:[NaN,NaN],outliers:0,outlier_ratio:0,sample_size:0,raw_sample_size:e.times.length,stability_ratio:0,unstable_iterations:e.times.length,ops_per_second:0,failed_iterations:o};const{cleaned_times:n,outliers:s}=Gt(t),r=[...n].sort((y,N)=>y-N),i=n.reduce((y,N)=>y+N,0)/n.length,_=fe(r),l=n.reduce((y,N)=>y+(N-i)**2,0)/n.length,a=Math.sqrt(l),c=r[0],v=r[r.length-1],p=r[Math.floor(r.length*Bt)],d=r[Math.floor(r.length*Ht)],u=a/i,m=a/Math.sqrt(n.length),x=qt*m,f=i-x,M=i+x,T=e.stability_checks.filter(y=>!y.is_stable).length,E=1-T/e.stability_checks.length,I=i>0?Vt/i:0;return{mean:i,median:_,std_dev:a,min:c,max:v,p95:p,p99:d,cv:u,confidence_interval:[f,M],outliers:s.length,outlier_ratio:s.length/t.length,sample_size:n.length,raw_sample_size:e.times.length,stability_ratio:E,unstable_iterations:T,ops_per_second:I,failed_iterations:o}},Xt=e=>{const t={};for(const s of e)t[s.implementation]||(t[s.implementation]=[]),t[s.implementation].push(s);const o={};for(const[s,r]of Object.entries(t)){const i=r.map(c=>c.mean),_=i.reduce((c,v)=>c+v,0)/i.length,l=r.map(c=>c.ops_per_second).reduce((c,v)=>c+v,0)/r.length,a=r.map(c=>c.cv).reduce((c,v)=>c+v,0)/r.length;o[s]={avg_mean:_,avg_ops:l,avg_cv:a,languages:r.length}}const n=o.html.avg_mean;for(const s of Object.keys(o))o[s].relative_speed=n/o[s].avg_mean,o[s].improvement=(o[s].relative_speed-1)*100;return o},Zt=(e,t=.15)=>{const o=[];for(const n of e)n.cv>t&&o.push(`High variance for ${n.implementation}/${n.language}: CV=${(n.cv*100).toFixed(1)}%`);return o},P=(e,t=2)=>e.toFixed(t),ae=[{header:"Language",key:"language",format:e=>e},{header:"Implementation",key:"implementation",format:e=>e},{header:"Mean (ms)",key:"mean",format:e=>P(e)},{header:"Median (ms)",key:"median",format:e=>P(e)},{header:"Std Dev",key:"std_dev",format:e=>P(e)},{header:"CV",key:"cv",format:e=>`${P(e*100,1)}%`,class:e=>e>.15?"warning":""},{header:"P95 (ms)",key:"p95",format:e=>P(e)},{header:"Ops/sec",key:"ops_per_second",format:e=>P(e,0)},{header:"Outliers",key:"outliers",format:(e,t)=>`${e}/${t.raw_sample_size}`,class:(e,t)=>t.outlier_ratio>.1?"warning":""},{header:"Failed",key:"failed_iterations",format:e=>e.toString(),class:e=>e>0?"warning":""},{header:"Stability",key:"stability_ratio",format:e=>`${P(e*100,0)}%`,class:e=>e>.9?"good":""}],Jt=e=>{if(e.length===0)return"";const t=ae.map(n=>n.header);let o="| "+t.join(" | ")+` |
`;o+="| "+t.map(()=>"---").join(" | ")+` |
`;for(const n of e){const s=ae.map(r=>r.format(n[r.key],n));o+="| "+s.join(" | ")+` |
`}return o};var Kt=A("<li> </li>"),Yt=A('<section class="panel p_md warning"><h3 class="mt_0">⚠️ Warnings</h3> <ul></ul></section>'),en=A("<div><strong> </strong> <span>vs baseline</span></div>"),tn=A("<div><h3> </h3> <div><strong> </strong> <span>avg time</span></div> <div><strong> </strong> <span>ops/sec</span></div> <div><strong> </strong> <span>CV</span></div> <!></div>"),nn=A("<section><h2>Summary</h2> <div></div></section>"),rn=A("<th> </th>"),on=A("<td> </td>"),an=A("<tr></tr>"),sn=A(`<section><h2>Results</h2> <table><thead><tr></tr></thead><tbody></tbody></table> <div class="mt_md"><!></div> <div><h3>Legend</h3> <ul><li><strong>CV</strong>: Coefficient of Variation (std_dev/mean) - lower is better, &lt;15% is
					good</li> <li><strong>P95</strong>: 95th percentile - 95% of measurements were faster than this</li> <li><strong>Ops/sec</strong>: Operations per second (throughput)</li> <li><strong>Per Item</strong>: Time per individual component in batch</li> <li><strong>Stability</strong>: Percentage of iterations with stable system metrics</li></ul></div></section>`),ln=A("<!> <!> <!>",1);function cn(e,t){ee(t,!0);const o=B(t,"results",19,()=>[]),n=B(t,"summary",3,null),s=B(t,"warnings",19,()=>[]);var r=ln(),i=W(r);{var _=p=>{var d=Yt(),u=S(b(d),2);K(u,20,s,m=>m,(m,x)=>{var f=Kt(),M=b(f,!0);g(f),V(()=>L(M,x)),$(m,f)}),g(u),g(d),$(p,d)};U(i,p=>{s().length>0&&p(_)})}var l=S(i,2);{var a=p=>{var d=nn(),u=S(b(d),2);K(u,20,()=>Object.entries(n()),m=>m,(m,x)=>{const f=he(()=>{const[j,w]=x;return{impl:j,stats:w}});var M=tn(),T=b(M),E=b(T,!0);g(T);var I=S(T,2),y=b(I),N=b(y);g(y),q(2),g(I);var R=S(I,2),O=b(R),X=b(O,!0);g(O),q(2),g(R);var D=S(R,2),H=b(D),ie=b(H);g(H),q(2),g(D);var le=S(D,2);{var ce=j=>{var w=en(),F=b(w);let G;var Z=b(F);g(F),q(2),g(w),V((ne,ue)=>{G=ge(F,1,"",null,G,ne),L(Z,`${h(f).stats.improvement>0?"+":""}${ue??""}%`)},[()=>({positive:h(f).stats.improvement>0,negative:h(f).stats.improvement<0}),()=>P(h(f).stats.improvement,1)]),$(j,w)};U(le,j=>{h(f).impl!=="html"&&h(f).stats.improvement!==void 0&&j(ce)})}g(M),V((j,w,F)=>{L(E,h(f).impl),L(N,`${j??""}ms`),L(X,w),L(ie,`${F??""}%`)},[()=>P(h(f).stats.avg_mean),()=>P(h(f).stats.avg_ops,0),()=>P(h(f).stats.avg_cv*100,1)]),$(m,M)}),g(u),g(d),$(p,d)};U(l,p=>{n()&&p(a)})}var c=S(l,2);{var v=p=>{var d=sn(),u=S(b(d),2),m=b(u),x=b(m);K(x,20,()=>ae,E=>E,(E,I)=>{var y=rn(),N=b(y,!0);g(y),V(()=>L(N,I.header)),$(E,y)}),g(x),g(m);var f=S(m);K(f,20,o,E=>E,(E,I)=>{var y=an();K(y,20,()=>ae,N=>N,(N,R)=>{var O=on(),X=b(O,!0);g(O),V((D,H)=>{ge(O,1,D),L(X,H)},[()=>{var D;return ft(((D=R.class)==null?void 0:D.call(R,I[R.key],I))||"")},()=>R.format(I[R.key],I)]),$(N,O)}),g(y),$(E,y)}),g(f),g(u);var M=S(u,2),T=b(M);{let E=he(()=>Jt(o()));Ft(T,{get text(){return h(E)},children:(I,y)=>{q();var N=De("copy results as markdown");$(I,N)},$$slots:{default:!0}})}g(M),q(2),g(d),$(p,d)};U(c,p=>{o().length>0&&p(v)})}$(e,r),te()}const se=()=>new Promise(e=>{requestAnimationFrame(()=>{requestAnimationFrame(()=>{e()})})}),Oe=async e=>{const t=e+Math.random()*e;await new Promise(o=>setTimeout(o,t)),await se(),await se()};var un=A("<div><!></div>");function _n(e,t){ee(t,!0);const o=B(t,"Benchmarked_Component",3,null),n=B(t,"props",3,null),s=B(t,"on_render_complete",3,()=>{});let r;bt(async()=>{const a=r.querySelector("code"),c=a.getBoundingClientRect(),v=a.offsetHeight;(c.width<=0||v<=0)&&console.error("Unexpected negative dimensions"),await se(),s()()});var i=un(),_=b(i);{var l=a=>{var c=Y(),v=W(c);Et(v,o,(p,d)=>{d(p,_t(n))}),$(a,c)};U(_,a=>{o()&&n()&&a(l)})}g(i),Ie(i,a=>r=a,()=>r),$(e,i),te()}function dn(e,t){ee(t,!0);const o=1e4;let n=k(null),s=k(null),r=null,i=k(0);const _=()=>{r&&(r(),r=null)};let l;const a=async(m,x)=>{st(i);const f=new Promise((T,E)=>{r=T,l=setTimeout(()=>{r&&(console.error("[Harness] Render timeout after",o,"ms"),r=null,l=void 0,E(new Error(`Render timeout after ${o}ms`)))},o)}),M=performance.now();try{C(n,m,!0),C(s,x,!0),await f,l&&(clearTimeout(l),l=void 0);const E=performance.now()-M;return await se(),E}catch(T){throw console.error("[Harness] Render failed:",T),T}finally{await c()}},c=async()=>{C(n,null),C(s,null),r=null,l&&(clearTimeout(l),l=void 0),await Se()};var v={run_iteration:a,cleanup:c},p=Y(),d=W(p);{var u=m=>{var x=Y(),f=W(x);Mt(f,()=>h(i),M=>{_n(M,{get Benchmarked_Component(){return h(n)},get props(){return h(s)},on_render_complete:_})}),$(m,x)};U(d,m=>{h(n)&&h(s)&&m(u)})}return $(e,p),te(v)}const mn=5,Ae=5,Fe=.9,Le=2,Me={high_lag:200,memory_pressure:500,high_jitter:300,unknown:300},fn=e=>{if(e.length<mn)return 0;const t=e.slice(-10),o=t.reduce((r,i)=>r+i,0)/t.length,n=t.reduce((r,i)=>r+(i-o)**2,0)/t.length;return Math.sqrt(n)/o},vn=async e=>{const t=performance.now();await new Promise(i=>setTimeout(i,0));const o=performance.now()-t;let n=0;typeof performance<"u"&&performance.memory&&(n=performance.memory.usedJSHeapSize/performance.memory.jsHeapSizeLimit);const s=fn(e);return{is_stable:o<Ae&&n<Fe&&s<Le,lag:o,memory_pressure:n,jitter:s}},pn=e=>e.lag>Ae?"high_lag":e.jitter>Le?"high_jitter":e.memory_pressure&&e.memory_pressure>Fe?"memory_pressure":"unknown",hn=async e=>{console.log(`System instability: ${e}, waiting...`),await new Promise(t=>setTimeout(t,Me[e]||Me.unknown))},gn=(e,t)=>Object.values(e).find(o=>o.lang===t&&o.name.includes("complex")),yn=(e,t,o)=>{const n=new Map;for(const s of t){const r=gn(e,s);if(!r)continue;const i=r.content.repeat(o);n.set(s,i);const _=(new TextEncoder().encode(i).length/1024).toFixed(1);console.log(`[Fixtures] Pre-generated ${s}: ${_}KB (${o}x)`)}return n},Pe=[{name:"html",component:xt,mode:null},{name:"ranges",component:gt,mode:"ranges"}],ke=["ts","css","html","json","svelte","md"],wn=.01,bn=6e4,En=.1,xn=.2,Mn=async(e,t,o,n,s,r)=>{for(let i=0;i<n;i++){const _={content:t,lang:o};e.mode!==null&&(_.mode=e.mode),await r.run_iteration(e.component,_),await Oe(s)}},Tn=async(e,t,o,n,s,r,i,_)=>{const l=[],a=[],c=[];for(let v=0;v<n.iterations;v++){if(_!=null&&_()){console.log("[Measurement] Stopped by user");break}console.log(`[Measurement] Iteration ${v+1}/${n.iterations}`),await Oe(n.cooldown_ms);const p=await vn(s);if(a.push(p),!p.is_stable){const u=pn(p);console.log(`[Measurement] System unstable: ${u}, extended cooldown...`),await hn(u)}const d={content:t,lang:o};e.mode!==null&&(d.mode=e.mode),console.log(`[Measurement] Running iteration ${v+1}...`);try{const u=await r.run_iteration(e.component,d);u<=0?(console.warn(`[Measurement] Suspicious timing (${u}ms) - marking as failed`),l.push(NaN),c.push(Date.now())):u<wn?(console.warn(`[Measurement] Suspiciously fast timing (${u}ms) - possible no-op render`),l.push(u),c.push(Date.now()),s.push(u)):u>bn?(console.warn(`[Measurement] Extremely slow timing (${u}ms) - possible hang`),l.push(NaN),c.push(Date.now())):(console.log(`[Measurement] Iteration ${v+1} complete: ${u.toFixed(2)}ms`),l.push(u),c.push(Date.now()),s.push(u))}catch(u){console.error(`[Measurement] Iteration ${v+1} failed:`,u),l.push(NaN),c.push(Date.now())}i&&i(),globalThis.gc&&globalThis.gc()}return{times:l,stability_checks:a,timestamps:c}},Nn=async(e,t,o,n,s,r)=>{var f,M,T;const i=Pe,_=ke,l=[],a=[],c=[],p=i.length*_.length*t.iterations;let d=0;console.log(`[Runner] Pre-generating large content (${t.content_multiplier}x)...`);const u=yn(e,_,t.content_multiplier);console.log("[Runner] Pre-generation complete");for(const E of _){if((f=n==null?void 0:n.should_stop)!=null&&f.call(n)){console.log("[Runner] Benchmark stopped by user");break}const I=u.get(E);if(!I){a.push(`No complex sample found for ${E}`);continue}for(const y of i){if((M=n==null?void 0:n.should_stop)!=null&&M.call(n)){console.log("[Runner] Benchmark stopped by user");break}const N=`${y.name} / ${E}`;console.log(`
[Runner] Starting test: ${N}`),n!=null&&n.on_test_start&&n.on_test_start(N);try{await Mn(y,I,E,t.warmup_count,t.cooldown_ms,o);const R=await Tn(y,I,E,t,c,o,()=>{d++,n!=null&&n.on_progress&&n.on_progress(d,p)},n==null?void 0:n.should_stop),O=Qt(R);console.log(`[Runner] ${N} complete - mean: ${O.mean.toFixed(2)}ms, ops/sec: ${O.ops_per_second.toFixed(2)}`),O.failed_iterations>0&&a.push(`${N}: ${O.failed_iterations} failed iterations`),O.mean<En&&a.push(`${N}: Suspiciously fast mean time (${O.mean.toFixed(3)}ms)`),O.outlier_ratio>xn&&a.push(`${N}: High outlier ratio (${(O.outlier_ratio*100).toFixed(1)}%)`),l.push({implementation:y.name,language:E,...O}),n!=null&&n.on_test_complete&&n.on_test_complete()}catch(R){console.error(`Error testing ${y.name}/${E}:`,R),a.push(`Failed: ${y.name}/${E}`)}}}const m=Xt(l),x=Zt(l);return a.push(...x),(T=n==null?void 0:n.should_stop)!=null&&T.call(n)&&a.push("Benchmark was stopped by user"),await o.cleanup(),{results:l,warnings:a,summary:m}},Sn=(e,t,o)=>{C(t,!0),C(o,"Stopping...")};var In=A('<button type="button" class="mt_lg">stop benchmark</button>'),Rn=A('<section class="panel"><h3>Progress</h3> <div class="progress-info"><div>Testing: <strong> </strong></div> <div> </div></div> <progress></progress></section>'),Cn=A('<div class="box width_upto_lg mx_auto"><h1 class="mt_xl5">benchmark</h1> <p><code class="font_weight_400 font_size_sm">chromium --js-flags="--expose-gc"</code></p> <section class="panel p_lg"><form><fieldset><legend>config</legend> <label><div class="title">iterations</div> <input type="number" min="10"/></label> <label><div class="title">content multiplier</div> <input type="number" min="50"/></label> <label><div class="title">warmup runs</div> <input type="number" min="3"/></label> <label><div class="title">cooldown (ms)</div> <input type="number" min="10"/></label></fieldset> <button type="button"> </button> <!></form></section> <!> <!> <hr/></div> <!>',1);function Bn(e,t){ee(t,!0);const o=it({iterations:10,warmup_count:3,cooldown_ms:100,content_multiplier:20});let n=k(!1),s=k(""),r=k(0),i=k(0),_=k(!1),l=k(null),a;const c=async()=>{if(!a)throw Error();if(!h(n)){C(n,!0),C(_,!1),C(s,""),C(r,0),C(l,{results:[],warnings:[],summary:null}),C(i,Pe.length*ke.length*o.iterations);try{C(l,await Nn(yt,o,a,{on_progress:(w,F)=>{C(r,w,!0),C(i,F,!0)},on_test_start:w=>{C(s,w,!0)},should_stop:()=>h(_)})),C(s,h(_)?"Stopped":"Complete",!0)}catch(w){console.error("Benchmark failed:",w),h(l).warnings.push(`Fatal error: ${w}`)}finally{C(n,!1)}}};var v=Cn(),p=W(v),d=S(b(p),4),u=b(d),m=b(u),x=S(b(m),2),f=S(b(x),2);re(f),g(x);var M=S(x,2),T=S(b(M),2);re(T),g(M);var E=S(M,2),I=S(b(E),2);re(I),g(E);var y=S(E,2),N=S(b(y),2);re(N),g(y),g(m);var R=S(m,2);R.__click=c;var O=b(R,!0);g(R);var X=S(R,2);{var D=w=>{var F=In();F.__click=[Sn,_,s],vt(F,"",{},{"margin-left":"1rem"}),$(w,F)};U(X,w=>{h(n)&&w(D)})}g(u),g(d);var H=S(d,2);{var ie=w=>{var F=Rn(),G=S(b(F),2),Z=b(G),ne=S(b(Z)),ue=b(ne,!0);g(ne),g(Z);var ve=S(Z,2),Ue=b(ve);g(ve),g(G);var pe=S(G,2);g(F),V(()=>{L(ue,h(s)),L(Ue,`Progress: ${h(r)??""} / ${h(i)??""}`),pt(pe,h(r)),ht(pe,"max",h(i))}),$(w,F)};U(H,w=>{h(n)&&w(ie)})}var le=S(H,2);{var ce=w=>{cn(w,{get results(){return h(l).results},get summary(){return h(l).summary},get warnings(){return h(l).warnings}})};U(le,w=>{h(l)&&w(ce)})}q(2),g(p);var j=S(p,2);Ie(dn(j,{}),w=>a=w,()=>a),V(()=>{f.disabled=h(n),T.disabled=h(n),I.disabled=h(n),N.disabled=h(n),R.disabled=h(n),L(O,h(n)?"running...":"run benchmarks")}),oe(f,()=>o.iterations,w=>o.iterations=w),oe(T,()=>o.content_multiplier,w=>o.content_multiplier=w),oe(I,()=>o.warmup_count,w=>o.warmup_count=w),oe(N,()=>o.cooldown_ms,w=>o.cooldown_ms=w),$(e,v),te()}ct(["click"]);export{Bn as component};
